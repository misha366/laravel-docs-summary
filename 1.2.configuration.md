# Конфигурация
Чтобы получить информацию по конфигурации можно использовать следующую команду:

`php artisan about`

```sh

  Environment  ................................................  
  Application Name  ................................... Laravel  
  Laravel Version  ..................................... 12.8.1  
  PHP Version  ......................................... 8.2.28  
  Composer Version  ......................................... -  
  Environment  .......................................... local  
  Debug Mode  ......................................... ENABLED  
  URL  .............................................. localhost  
  Maintenance Mode  ....................................... OFF  
  Timezone  ............................................... UTC  
  Locale  .................................................. en  

  Cache  ......................................................  
  Config  .......................................... NOT CACHED  
  Events  .......................................... NOT CACHED  
  Routes  .......................................... NOT CACHED  
  Views  ............................................... CACHED  

  Drivers  ....................................................  
  Broadcasting  ........................................... log  
  Cache  ............................................. database  
  Database  ............................................. mysql  
  Logs  ........................................ stack / single  
  Mail  ................................................... log  
  Queue  ............................................. database  
  Session  ........................................... database  

  Storage  ....................................................  
  public/storage  .................................. NOT LINKED  

```

Если мы хотим вывод только конкретного блока, можно юзать флаг `--only`
`php artisan about --only=environment`


Чтобы детально посмотреть детали конфигурации определённого файла (в папке `config`), можно использовать команду:
`php artisan config:show filename`


Laravel использует PHP библиотеку DotEnv, для того чтобы записывать перменные окружения в `.env`

Любая переменная в вашем .env файле может быть переопределена внешними переменными среды, такими как переменные среды уровня сервера или системы.


### Дополнительные файлы среды (для ci?)
**Перед тем как загрузить переменные среды, ларавел определяет, была ли внешне определена переменная APP_ENV, либо же она была передана как аргумент --env через CLI**

Если это так, ларавел будет пытаться загрузить `.env.[APP_ENV]`, если такой переменной не будет ларавел загрузить .env




Если нам надо будет определить переменную среды со значением, содержащим пробелы, мы можем это сделать, заключив значение в двойные кавычки:
`APP_NAME="My Application"`

### Получить доступ к переменным
Переменные из `.env` будут выгружены в супер глобальную переменную `$_ENV`. Так же можно использовать функцию `env('field'[, 'default'])` для этой цели:
`'debug' => env('APP_DEBUG', false),`


### Определить текущее окружение в коде
В .env файле есть переменная APP_ENV, которая указывает, на какой стадии разработки находиться проект. И мы можем извлечь эту переменную для изменения поведения нашей программы, в зависимости от окружения.

Это можно делать с помощью фасада `App`:
```php
use Illuminate\Support\Facades\App;

$environment = App:environment(); // returns string, that contains current environment

if (App:environment('local')) { // returns bool
    // ...
}
```

Пример: у ларавел до 11 версии включительно есть такая особенность - для формирования урла ларавел юзает функцию `route()`, но она берёт домен не из `.env` файла (Переменная `APP_URL`), а из суперглобального массива пхп, точнее из `$_SERVER['HTTP_HOST']`, `$_SERVER['SERVER_NAME']`. Может возникнуть проблема, если мы работаем в окружении с обратным прокси - заголовок HTTP `Host` (из которого формируется `$_SERVER['SERVER_NAME']`) может подменится на localhost. Это исправляется с помощью доп. конифгурации nginx, но так же мы это можем сделать и в коде, засеттив в web.php урл нашего приложения из `APP_URL`:
```php

use Illuminate\Support\Facades\App;

if (App:environment('production')) {
    // set app url = env('APP_URL')
}

```

### Зашифровать .env файл
Мы можем создать файл `.env.encrypted`, в котором поместим наш исходный .env файл, зашифрованный с помощью симметричного ключа:
`php artisan env:encrypt [--key=key] [--env=envname]`
Можно самому указать ключ, но если мы этого не сделаем, ларавел сам его подберёт и выведет в консоль

Потом можно дешифровать наш .env файл:
`php artisan env:decrypt [--key=key]`
Дешифрует .env с помощью ключа в переменной окружения `LARAVEL_ENV_ENCRYPTION_KEY` или с помощью ключа в cli, если мы его указали
С помощью `--force` можно перезаписать текущий файл окружения.


### Получить доступ к значениям в папке config
Это можно делать с помощью фасада `Config` или с помощью глобальной функции `config('configname.key'[, 'defaultvalue'])`:
```php
use Illuminate\Support\Facades\Config;

$value = Config::get('app.timezone');
$value = config('app.timezone');
$value = config('app.timezone', 'Asia/Seoul');

Config::set('app.timezone', 'America/Chicago');
config(['app.timezone' => 'America/Chicago']);
```

Типизированные методы получения значений конфигурации (кинут ошибку, если тип не совпадает):
```php
Config::string('config-key');
Config::integer('config-key');
Config::float('config-key');
Config::boolean('config-key');
Config::array('config-key');
```

### Кэширование конфигурации
`php artisan config:cache`
Команда для того чтобы кэшировать конфигурацию - объеденить все конфигурационные файлы в один, а так же вместо всех вызовов env в этом файле подставляет нужные значение из `.env`, это позволит быстрее загружать конфигурацию. Эту команду надо запускать только во время развёртывания. *После кэширования `.env` файл не будет загружаться во время запросов или команд artisan; env функция будет возвращать только внешние переменные среды системного уровня*. По этой причине надо убедиться что мы вызываем env функцию только из config файлов.
Вместо (в файлах НЕ из папки config) `env()` лучше использовать `config()` - даже после кэширования мы сможем получать доступ к нужным нам значениям.

`php artisan config:clear` - почистить кэш

### Публикация конфигурации
Публиковать - выносить конфиг, которого там ещё нету в папку config, для того чтобы мы его могли в дальнейшем менять. Он как бы есть, работает и задаёт конфиг, но в папке config его нету и менять мы его не можем, поэтому его надо опубликовать.

Это делается потому, что есть такие файлы конфигурации (что не опубликованы по умолчанию, например - cors.php и view.php), которые нам не потребуется изменять в большинстве проектов, поэтому они не опубликованы.

```bash
php artisan config:publish

php artisan config:publish --all
```

### Дебаг
На продакшне надо обязательно отключать дебаг мод - APP_DEBUG=false

### Режим обслуживания
Режим обслуживания нужен для того, чтобы наше приложение не обрабатывало никаких запросов во время деплоя, дабы избежать неопределённого поведения
```bash
php artisan down [--refresh=15] # создаёт файл down в storage/framework/down; на все запросы отвечает 503
php artisan up # поднимает приложение
```
Можно указать refresh значение, чтобы браузер через определённое время попробовал обновить нашу страницу (значение в секундах)


